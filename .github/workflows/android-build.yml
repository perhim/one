
    name: Android build

    on:
      push:
        branches: [ main, master ]
      workflow_dispatch: {}

    jobs:
      build:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout
            uses: actions/checkout@v4

          - name: Set up Node.js
            uses: actions/setup-node@v4
            with:
              node-version: '18'

          - name: Install dependencies
            run: |
              npm ci

          - name: Sync Capacitor Android
            run: |
              npx cap sync android

          - name: Copy web assets into Android assets
            run: |
              echo "Copying web assets to android assets"
              mkdir -p android/app/src/main/assets/public
              rm -rf android/app/src/main/assets/public/*
              cp -a www/. android/app/src/main/assets/public/

          - name: Set up Java 17
            uses: actions/setup-java@v4
            with:
              distribution: temurin
              java-version: '17'

          - name: Make gradlew executable and show versions
            working-directory: android
            run: |
              chmod +x ./gradlew || true
              java -version || true
              ./gradlew --version || true

          - name: Build Android APK
            working-directory: android
            env:
              GRADLE_USER_HOME: ${{ runner.temp }}/.gradle
            run: |
              ./gradlew assembleDebug --no-daemon --stacktrace --info

          - name: Upload APK artifact
            uses: actions/upload-artifact@v4
            with:
              name: app-debug-apk
              path: android/app/build/outputs/apk/debug/app-debug.apk
