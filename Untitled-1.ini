// کوتاه: بارگذاری تنظیمات محلی و یک lib حداقلی تا run بتواند اجرا شود
(async () => {
  if (!window.gameConfig) {
    try {
      window.gameConfig = await fetch('config.json').then(r => r.json());
      console.log('Loaded config.json -> gameConfig');
    } catch (e) {
      console.warn('Could not load config.json locally:', e);
    }
  }

  if (!window.lib) {
    // lib حداقلی: فقط توابعی که کد شما استفاده می‌کند را پیاده‌سازی می‌کنیم
    window.lib = {
      getAsset: (id) => { return null; }, // برگشت null باعث می‌شود preload سریعاً عبور کند
      log: console.log.bind(console),
      showGameParameters: (opts) => { console.log('[lib.showGameParameters]', opts); },
      editMenu: { open: () => {}, close: () => {} },
      // اگر در کد شما توابع دیگری از lib لازم شد، اینجا اضافه کن
    };
    console.log('Stubbed window.lib (minimal).');
  }

  // در نهایت صدا زدن run در حالت play
  if (typeof run === 'function') {
    try {
      run('play');
      console.log('run(\"play\") called.');
    } catch (err) {
      console.error('run() threw:', err);
    }
  } else {
    console.error('run() not found on the page. The game entrypoint is missing.');
  }
})();